image: docker:20.10.16

variables:
  DOCKER_TLS_CERTDIR: "/certs"
  REGISTRY: 294727153669.dkr.ecr.us-east-1.amazonaws.com
  AWS_DEFAULT_REGION: us-east-1
  APP_NAME: grp-21-frontend
  DOCKER_HOST: tcp://docker:2375

services:
  - docker:20.10.16-dind

stages:
    - build

build:
    stage: build
    services:
      - docker:dind
    before_script:
        - docker info
        - aws --version
    script:
        - pwd
        - docker build -t $DOCKER_REGISTRY/$APP_NAME:latest .
        - aws ecr get-login-password | docker login --username AWS --password-stdin $DOCKER_REGISTRY
        - docker push $DOCKER_REGISTRY/$APP_NAME:latest
    only:
        - ci-cd
